# Лекция №11. Архитектура веб-приложений и REST API

## Архитектура веб-приложений

Веб-приложения строятся по принципам разделения ответственности между клиентом и сервером, что обеспечивает масштабируемость и гибкость разработки.

---

## Клиент-серверная архитектура

> **Клиент-серверная архитектура** — подход, при котором приложение разделяется на два компонента: клиент (интерфейс) и сервер (логика и данные).

- **Клиент** — браузер, мобильное или десктопное приложение  
- **Сервер** — обрабатывает запросы, выполняет логику, управляет данными

**Преимущества:**  
- Разделение ответственности  
- Независимая разработка фронтенда и бэкенда  
- Масштабируемость

![Клиент-серверная архитектура](https://cithub.ru/api/files/pirvp_lec_11_11_1.png)

---

## Single Page Application (SPA)

> **Single Page Application (SPA)** — веб-приложение, загружаемое как одна страница и динамически обновляющее контент без перезагрузки.

- Интерфейс обновляется через API-запросы  
- Обеспечивает плавный и быстрый UX

**Особенности:**  
- Подгрузка только необходимого контента  
- Использование React, Vue, Angular

---

## Application Programming Interface (API)

> **API (Application Programming Interface)** — набор правил и методов, с помощью которых одна программа может обращаться к функционалу другой; позволяет создавать гибкие приложения, где фронтенд и бэкенд могут развиваться независимо.

---

## Принцип работы API

Клиент отправляет запрос → сервер обрабатывает → возвращает данные → клиент отображает.

- Запросы и ответы передаются в формате **JSON**  
- Клиент не знает внутреннюю реализацию сервера

**Пример запроса:** `GET /api/items`  
**Пример ответа:**
```json
[
  { "id": 1, "name": "Футболка", "price": 1000 }
]
```

---

## Форматы передачи данных

> **JSON** — текстовый формат для передачи структурированных данных, удобный как для человека, так и для программ.

```json
[
  { "id": 1, "name": "Футболка", "price": 1000 },
  { "id": 2, "name": "Штаны", "price": 1500 }
]
```

> **XML (eXtensible Markup Language)** — текстовый формат с тегами, похожими на HTML; используется в некоторых старых сервисах.

```xml
<items>
  <item>
    <id>1</id>
    <name>Футболка</name>
    <price>1000</price>
  </item>
  <item>
    <id>2</id>
    <name>Штаны</name>
    <price>1500</price>
  </item>
</items>
```

> **Plain Text** — простой текст без структуры; используется для передачи логов, сообщений или данных, не требующих форматирования.

**Пример:**
```
1. Футболка - 1000
2. Штаны - 1500
```

**Современные API используют JSON** из-за простоты и читаемости.

---

## REST API

> **REST API** — архитектурный стиль, при котором сервер предоставляет ресурсы, а клиент обращается к ним через стандартные HTTP-запросы, получая их текущее состояние.

REST обеспечивает предсказуемость, независимость от платформы и масштабируемость.

![Модель REST API](https://cithub.ru/api/files/pirvp_lec_11_3_1.png)

---

## Принципы REST API

1. **Клиент-сервер** — чёткое разделение ролей  
2. **Отсутствие состояния** — каждый запрос самодостаточен  
3. **Кеширование** — поддержка HTTP-кеширования  
4. **Единообразный интерфейс** — стандартные методы и URI  
5. **Слоистая система** — промежуточные слои прозрачны для клиента

---

## Ресурсы и URI

> **Ресурс** — объект или сущность, доступная через API (пользователь, товар, заказ).

Каждый ресурс идентифицируется уникальным **URI** (Uniform Resource Identifier).

- URI идентифицирует ресурс  
- URI не содержит глаголов  
- Используется множественное число

**Примеры:**  
- `/api/users`  
- `/api/users/42`  
- `/api/orders?status=completed`

---

## HTTP-методы (CRUD)

| Метод   | Идемпотентность* | Безопасность** | Пример использования        |
|--------|------------------|----------------|-----------------------------|
| GET    | Да               | Да             | Получение данных            |
| POST   | Нет              | Нет            | Создание нового ресурса     |
| PUT    | Да               | Нет            | Полное обновление ресурса   |
| PATCH  | Нет              | Нет            | Частичное обновление ресурса|
| DELETE | Да               | Нет            | Удаление ресурса            |

> *Идемпотентность — повторный запрос даёт тот же результат.  
> **Безопасность — метод не изменяет состояние ресурса.

**Примеры операций:**  
- `GET /api/books/123` — получить информацию о книге  
- `DELETE /api/comments/456` — удалить комментарий

---

## Заголовки HTTP

Заголовки передают метаинформацию о запросе или ответе.

**Популярные заголовки:**  
- `Authorization` — токен аутентификации  
- `Cache-Control` — управление кешированием  
- `ETag` — идентификатор версии ресурса

**Пример запроса:**  
```http
GET /api/users/42 HTTP/1.1
Host: api.example.com
Accept: application/json
Authorization: Bearer xyz123
Cache-Control: no-cache
```

---

## Коды состояния HTTP

**1xx — Информационные**  
- `100 Continue` — сервер готов принять тело запроса  
- `101 Switching Protocols` — подтверждение переключения протокола (например, на WebSocket)

**2xx — Успех**  
- `200 OK` — успешный запрос  
- `201 Created` — ресурс создан  
- `204 No Content` — успешно, без тела ответа  

**3xx — Перенаправления**  
- `304 Not Modified` — используйте кеш  

**4xx — Ошибки клиента**  
- `400 Bad Request` — неверный синтаксис  
- `401 Unauthorized` — требуется авторизация  
- `403 Forbidden` — доступ запрещён  
- `404 Not Found` — ресурс не найден  
- `429 Too Many Requests` — превышен лимит  

**5xx — Ошибки сервера**  
- `500 Internal Server Error` — общая ошибка  
- `503 Service Unavailable` — сервис недоступен  

---

## Тело запроса и ответа

- Запрос: данные в теле (обычно JSON)  
- Ответ: данные или ошибка в JSON

Создание пользователя:
```http
POST /api/users HTTP/1.1
Content-Type: application/json
```
```json
{
  "name": "Алексей Петров",
  "email": "alex@example.com"
}
```

Ответ сервера:
```http
HTTP/1.1 201 Created
Location: /api/users/101
Content-Type: application/json
```
```json
{
  "id": 101,
  "name": "Алексей Петров",
  "email": "alex@example.com",
  "status": "active"
}
```

---

## Лучшие практики REST

При проектировании REST API рекомендуется следовать следующим правилам:

1. **Использовать множественное число в URI**  

Пример: `/users`, `/users/42`. Не рекомендуется: `/user/42`.

2. **Разделять ресурсы и действия**  

URI описывает сущность, а не действие.  
Правильно: `POST /orders`  
Неправильно: `POST /createOrder`

3. **Использовать пагинацию и фильтры**  

Пример:  
- `/users?page=2&limit=50` — пагинация  
- `/orders?status=completed` — фильтрация

4. **Использовать корректные HTTP-методы**  

- `GET` — получение  
- `POST` — создание  
- `PUT`/`PATCH` — обновление  
- `DELETE` — удаление

5. **Использовать плоские и читаемые URI**  

Вместо: `/api/users/42/profile/address/street`  
Лучше:  
- `/api/users/42`  
- `/api/addresses?user_id=42`  
Цель — улучшить читаемость, предсказуемость и расширяемость.

6. **Документировать API**  

Использовать спецификации OpenAPI/Swagger для описания эндпоинтов, форматов и ошибок.

---

## Документирование API

> **Документация API** — описание эндпоинтов, форматов, параметров и ошибок.

- **Swagger / OpenAPI** — стандарт для автоматической генерации документации

![Swagger / OpenAPI](https://cithub.ru/api/files/pirvp_lec_11_41_1.png)

---

## Клиенты для отправки запросов

- **Postman** — графический инструмент для тестирования API  
- **Insomnia** — альтернатива с поддержкой GraphQL  
- **curl** — утилита командной строки для быстрой проверки

![Postman](https://cithub.ru/api/files/pirvp_lec_11_42_1.png)

---

## Локальное тестирование API

> **Локальное тестирование** — разработка фронтенда без сервера с использованием моков.

- **Инструменты:** `json-server`, `Mockoon`  
- Позволяет моделировать ответы и ошибки  
- Ускоряет параллельную разработку
