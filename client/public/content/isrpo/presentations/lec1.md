# Лекция №1. Git: система контроля версий

## Система контроля версий (СКВ): определение, назначение и роль в разработке

> **Система контроля версий** — это программное обеспечение, предназначенное для управления изменениями в файлах.

Обеспечивает:
- Фиксацию истории модификаций
- Хранение последовательных версий
- Контроль над развитием проекта

---

## Ключевые возможности СКВ

1. **Ведение хронологической истории** — автоматическое сохранение последовательных версий файлов
2. **Возможность отката** — быстрое восстановление любой предыдущей стабильной версии
3. **Сравнение изменений** — анализ различий между версиями файлов
4. **Трассируемость** — фиксация автора, времени и цели каждого изменения

---

## Практический пример

**Ситуация:** После добавления новой функции (например, таймера) обнаружен критический сбой

**Без СКВ:**
- Ручной поиск и отмена изменений
- Длительный простой проекта

**С использованием СКВ:**
- Мгновенный откат к последней рабочей версии
- Быстрое восстановление работоспособности

---

## Назначение и роль в разработке

СКВ решает несколько фундаментальных задач:  
1. **Управление историей изменений** — устранение необходимости ручного создания копий файлов.  
2. **Обеспечение стабильности** — защита проекта от последствий внедрения некорректных изменений.  
3. **Контроль и прозрачность** — отслеживание состояния файлов и активности разработчиков для координации работы.  
4. **Коллаборативная разработка** — безопасная параллельная работа команды над проектом с автоматическим управлением конфликтами.  
5. **Распространение кода** — обмен исходным кодом и привлечение сторонних разработчиков.

---

## Архитектуры систем контроля версий

Три основных архитектурных подхода:
1. **Локальная**
2. **Централизованная**
3. **Распределённая**

Эволюция продиктована потребностями командной работы и надёжности

---

## Локальная система контроля версий

> **Локальная система контроля версий** — система, в которой история изменений хранится в локальной базе данных на компьютере пользователя.

**Преимущества:**
- Работа без подключения к интернету
- Полная независимость от внешних серверов

**Недостатки:**
- Высокий риск потери всей истории при сбое компьютера
- Невозможность командной работы

![Схема работы локальной СКВ](https://cithub.ru/api/files/isrpo_lec_1_21_1.png)

---

## Централизованная система контроля версий

> **Централизованная система контроля версий** — архитектура, в которой существует единый центральный сервер, хранящий полную историю изменений. Разработчики получают из него файлы и отправляют обратно свои изменения.

**Примеры:** CVS, Subversion (SVN), Perforce

**Преимущества:**
- Возможность командной работы
- Централизованное управление правами
- Полная видимость процесса разработки

**Недостатки:**
- **Единая точка отказа** — при недоступности сервера работа парализуется
- **Риск потери данных** — при повреждении сервера теряется вся история
- Зависимость от качества сетевого соединения

![Схема работы централизованной СКВ](https://cithub.ru/api/files/isrpo_lec_1_22_1.png)

---

## Распределённая система контроля версий

> **Распределённая система контроля версий** — архитектура, в которой каждый разработчик клонирует **полный репозиторий**, включая всю историю изменений.

**Примеры:** Git, Mercurial, Bazaar

**Преимущества:**
1. **Отказоустойчивость** — при падении основного сервера любой локальный репозиторий может быть использован для восстановления
2. **Гибкость работы** — поддержка множества удалённых репозиториев, идеально для open-source проектов

![Схема работы распределенной СКВ](https://cithub.ru/api/files/isrpo_lec_1_23_1.png)

---

## Система контроля версий Git

> **Git** — ведущая современная распределённая система контроля версий с открытым исходным кодом, основанная на принципах распределённой архитектуры, но поддерживающая и полностью локальную работу.

---

## Ключевые преимущества Git

1. **Полная локальная копия репозитория**  

Каждый разработчик хранит на своём компьютере полную копию проекта со всей историей изменений, что обеспечивает:  
- **Высокую скорость** выполнения операций.  
- **Автономную работу** без постоянного подключения к интернету.  
- **Простое управление** через одну скрытую папку `.git` в корне проекта.  
- **Свободу экспериментировать** с созданием веток и тестированием без влияния на общий код.

2. **Гибкое управление историей (коммитами)**  

Git предоставляет расширенные возможности для работы с коммитами:  
- Редактирование, удаление, объединение и разделение коммитов.  
- Перемещение коммитов между ветками.  

Это позволяет поддерживать чистую и логичную историю проекта.

---

## Ключевые преимущества Git (продолжение)

3. **Мощная система веток (Branches)**  

Ветвление — фундаментальный принцип работы в Git:  
- Создание, переключение и слияние веток — быстрые и простые операции.  
- Короткоживущие ветки (1–3 дня) используются для разработки новых функций, исправления ошибок, после чего сливаются с основной веткой.  

Это позволяет вести параллельную разработку без риска нарушения стабильности основного кода.

4. **Точный контроль над коммитами**  

Коммит в Git фиксирует не файлы целиком, а конкретные изменения:  
- Можно включить в коммит только определённые файлы или даже части изменений внутри файла.  
- Детальный просмотр истории и сравнения между любыми версиями.

---

## Ключевые преимущества Git (продолжение)

5. **Временное сохранение изменений (Stash)**  

Функция `git stash` позволяет «отложить» незавершённые изменения, чтобы временно переключиться на другую задачу или ветку, не создавая промежуточных коммитов.

6. **Эффективная командная работа**  

Рабочий процесс строится вокруг веток:  
- Каждая задача выполняется в отдельной ветке.  
- Перед слиянием с основной веткой код проходит проверку (code review).  

Такой подход гарантирует, что в основной код попадает только проверенный и рабочий функционал.

7. **Интеграция с облачными платформами (GitHub, BitBucket, GitLab)**  

Эти сервисы предоставляют удалённые репозитории для:  
- Хостинга и совместной работы над open-source и приватными проектами.  
- Организации процессов через forks, pull requests, issue tracking и code review.  
- Создания портфолио для разработчиков.

---

## Основные понятия Git

> **Репозиторий** — каталог проекта, в котором Git отслеживает изменения. Вся история и служебные данные хранятся в подкаталоге `.git`. Репозиторий может быть локальным или удалённым.

> **Коммит** — фиксация изменений, добавленных в индекс. Каждый коммит содержит снимок файлов, автора, метку времени и уникальный идентификатор (хеш), позволяющий вернуться к этой версии.

> **Ветка** — указатель на конкретный коммит, создающий независимую линию разработки. Ветки позволяют работать над разными задачами параллельно, не влияя на основной код. По умолчанию создаётся ветка `main` (или `master`).

> **Индекс** (или *Staging Area*) — промежуточная область, куда помещаются изменения перед коммитом. Сюда файлы попадают командой `git add`, что позволяет точно выбирать, что войдёт в следующую фиксацию.

> **Рабочий каталог** — текущие файлы проекта, с которыми вы работаете напрямую. Это видимая часть репозитория, не включающая служебные данные из `.git`.

> **HEAD** — специальный указатель, который показывает, где вы находитесь в истории: на какой коммит или ветку сейчас ссылается репозиторий. Перемещается при переключении между коммитами или ветками.

---

## Настройки Git

### Уровни настроек

В Git существует три уровня настроек, которые определяют область их применения:

1. **Системные настройки**  

Действуют для **всех пользователей и репозиториев** на компьютере.  

2. **Глобальные настройки**  

Применяются ко **всем репозиториям текущего пользователя**.  

3. **Локальные настройки**  

Действуют **только в рамках конкретного репозитория**.  

> **Приоритет:** Локальные → Глобальные → Системные (локальные имеют наивысший приоритет).

---

## Управление настройками через `git config`

```bash
git config [<ключ-уровня>] <параметр> <значение>
```

- **Без ключа** — изменение настроек **локально**, только для текущего репозитория.  
- `--global` — изменение настроек **глобально**, для всех репозиториев текущего пользователя.  
- `--system` — изменение настроек **системно**, для всех пользователей компьютера (требует прав администратора).

**Основные параметры для настройки**  
- `user.name` — имя пользователя (отображается в авторах коммитов).  
- `user.email` — электронная почта пользователя (идентификатор для коммитов).

---

## Примеры `git config` ##
```bash
# Установка имени пользователя в текущем репозитории (локальный уровень)
$ git config user.name "John"

# Просмотр значения параметра
$ git config user.name
John

# Установка электронной почты глобально (для всех ваших проектов)
$ git config --global user.email "daniella@email.com"

# Просмотр всех настроек текущего уровня
$ git config --list

# Установка системной настройки (для всех пользователей)
$ git config --system color.ui auto
```

---

## Создание репозитория

> **Команда `git init`** — превращает текущую папку в репозиторий Git, создавая в ней скрытую папку `.git`.

```bash
git init [опции]
```

Создаёт пустой репозиторий в текущей директории.

---

## Пример `git init` ##

```bash
# Переходим в папку проекта
$ cd projects/my_project

# Инициализируем репозиторий
$ git init
Initialized empty Git repository in /path/to/projects/my_project/.git/
```

**Что происходит после выполнения**  
- Создаётся скрытая папка `.git` со всей структурой Git.  
- Появляется начальная ветка (обычно `main` или `master`).  
- Папка готова к отслеживанию файлов и созданию коммитов.

---

## Состояния файлов и рабочие области Git

### Три основные области Git

1. **Рабочий каталог** — текущие файлы проекта
2. **Индекс (Index / Staging Area)** — изменения, подготовленные для следующего коммита
3. **Репозиторий (Git Directory)** — база данных Git (папка `.git`), где хранятся все коммиты и история изменений.

> **Переходы:** Рабочий каталог → (`git add`) → Индекс → (`git commit`) → Репозиторий

---

## Состояния файлов в Git

Каждый файл может находиться в одном из двух основных состояний:

**Отслеживаемые файлы (Tracked)**  
Файлы, известные Git (были в предыдущем коммите или добавлены в индекс). Имеют три подсостояния:  
- **Неизменённый (Unmodified)** — файл не менялся с последнего коммита.  
- **Изменённый (Modified)** — файл был изменён в рабочем каталоге.  
- **Подготовленный (Staged)** — изменения файла добавлены в индекс командой `git add` и готовы к коммиту.

**Неотслеживаемые файлы (Untracked)**  
Новые файлы, которые Git ещё не отслеживает (не были в коммитах и не добавлены в индекс).

---

## Команда `git status`

> **Команда `git status`** — показывает текущее состояние файлов в рабочем каталоге и индексе.

```bash
git status [опции]
```

Отображает список изменённых, подготовленных и неотслеживаемых файлов.

```bash
$ git status
On branch develop
No commits yet

Untracked files:
  alpha.txt
  num.txt
```

Показывает:
- Текущую ветку
- Файлы в разных состояниях
- Подсказки по дальнейшим действиям

---

## Пример `git status`

```bash
# Создадим два файла
$ echo "a" > alpha.txt
$ echo "1" > num.txt

# Проверим статус
$ git status
On branch develop
No commits yet

Untracked files:
  (use "git add <file>..." to include in what will be committed)
        alpha.txt
        num.txt

nothing added to commit but untracked files present (use "git add" to track)
```

**Вывод команды показывает**  
- Текущую ветку (`On branch develop`)  
- Файлы в разных состояниях:  
  - **Untracked files** — неотслеживаемые  
  - **Changes to be committed** — подготовленные к коммиту  
  - **Changes not staged for commit** — изменённые, но не добавленные в индекс  
- Подсказки по дальнейшим действиям

> **Важно:** `git status` — основная команда для понимания, что происходит в репозитории перед созданием коммитов.

---

## Внутреннее устройство Git: объекты

> **Объекты Git** — файлы в директории `.git/objects/`, в которых хранится вся информация репозитория; каждый объект имеет уникальный SHA-1 идентификатор.

## Типы объектов Git

- **Blob (Binary Large Object)** — хранит сжатое содержимое файла (без имени и метаданных); создаётся при выполнении `git add`.  
- **Tree (Дерево)** — описывает структуру каталога, содержа список вложенных файлов (blob) и поддиректорий (tree); создаётся при коммите.  
- **Commit (Коммит)** — содержит метаданные фиксации: автора, дату, сообщение, ссылку на tree корневой директории и ссылку на родительский коммит.

**Связь объектов:**
```bash
Коммит → Tree (корень) → [Blob (файл1), Tree (папка) → Blob (файл2)]
```

---

## Команда `git add`

> **Команда `git add`** — добавляет изменения из рабочего каталога в индекс (staging area), подготавливая их к коммиту.

```bash
# Добавить конкретный файл
$ git add file.cs

# Добавить все изменённые файлы
$ git add -A
```

**Как работает изнутри:**
1. Создаёт blob-объект с содержимым файла
2. Сохраняет в `.git/objects/`
3. Добавляет запись в файл индекса `.git/index`

---

## Пример `git add`

После выполнения команды файл попадает в индекс и становится отслеживаемым (staged).

```bash
$ git status
On branch develop
No commits yet

Changes to be committed:
  (use "git rm --cached <file>..." to unstage)
        new file:   file.txt

Untracked files:
  (use "git add <file>..." to include in what will be committed)
        num.txt
```

---

## Команда `git commit`

> **Команда `git commit`** — создаёт новый коммит, фиксирующий все изменения, добавленные в индекс (staging area).

```bash
$ git commit -m "Add math hometask"
[master 0b1f669] Add math hometask
 11 files changed, 7 insertions(+)
```

**Флаги:**
- `-m "описание"` — сообщение коммита из командной строки
- `-c <хэш>` — использование сообщения из другого коммита с редактированием
- `-C <хэш>` — копирование сообщения без изменений

**Как работает изнутри:**
1. Создаёт tree-объекты структуры проекта
2. Формирует объект коммита с автором, датой, сообщением
3. Обновляет указатель текущей ветки

---

## Пример использования 

```bash
$ git commit -m "Add math hometask"
[master 0b1f669] Add math hometask
 11 files changed, 7 insertions(+), 638 deletions(-)
 rewrite .gitignore (99%)
 delete mode 100644 discrete math/hw-3/dm3.pdf
```

Вывод показывает:  
- Ветку (`master`)  
- Короткий хеш коммита (`0b1f669`)  
- Сообщение коммита  
- Статистику изменений

